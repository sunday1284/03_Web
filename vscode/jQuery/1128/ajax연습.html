<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
    <button>CSV</button>
    <button>JSON</button>
    <button>XML</button>
    <div></div>
    
<script>
    //ê°ì²´ ìƒì„± XMLHttpRequest
    const ajax = new XMLHttpRequest();
    //ìš”ì²­ì •ë³´ ì„¤ì • open() - urlë¡œ test.txt
    ajax.open('get','./sample/test.txt');
    //ìš”ì²­ ì „ë‹¬ send()
    ajax.send();

    //ì‘ë‹µ - test.txtì˜ ì •ë³´ë¥¼ ì½˜ì†”ë¡œ ì¶œë ¥í•˜ê¸° 
    //onreadystatechange, readyState, status, responseText
    ajax.onreadystatechange = function(){
        if(ajax.readyState == 4 && ajax.status == 200){
            console.log( ajax.responseText );
        }
    };

    document.querySelector('button').addEventListener('click',function(){
        //ajaxë¡œ test.csvíŒŒì¼ ì •ë³´ ì½˜ì†”ì— ì¶œë ¥í•˜ê¸°
        const req = new XMLHttpRequest();
        req.open('get','./sample/test.csv');
        req.send();
        req.onreadystatechange = function(){
            if(req.readyState == 4 && req.status == 200){
                //ë°”ê¹¥ìª½ í•¨ìˆ˜ë¡œ ì •ë³´ë¥¼ ì˜®ê²¨ì„œ.. ì‹¤í–‰ë¬¸ ì‘ì„±..
                f_csv(req.responseText);
            }
        }
    });

    function f_csv(p_csv){
        //ë„˜ì–´ì˜¨ csvì •ë³´ë¥¼ ì½¤ë§ˆë¡œ ë‚˜ëˆ ì„œ í…Œì´ë¸” ê° ì…€ì— ë°°ì¹˜..
        // console.log("ì •ë³´ í™•ì¸>> \r\n" ,  p_csv);

        let v_lines = p_csv.split("\r\n"); //ì¤„ë„˜ê¹€ê¸°í˜¸ë¡œ í•œì¤„ì”© ì •ë³´ ë‚˜ëˆ”
        console.log( v_lines);

        //í…Œì´ë¸” ìš”ì†Œì²˜ëŸ¼ ê³„ì¸µêµ¬ì¡°ë¥¼ ê°€ì§„ ìš”ì†Œë“¤ì€ (ë©”ì†Œë“œ ì‚¬ìš©ë³´ë‹¤) ë¬¸ìì—´ë¡œ ì‘ì„±í•˜ëŠ”ê²Œ ë” íš¨ìœ¨ì 
        let v_tbl = "<table border=1>";
        for(let i=0; i<v_lines.length; i++){
            v_tbl += "<tr>";
            
                let v_cells = v_lines[i].split(",");
                console.log( v_cells);

                for(let i=0; i<v_cells.length; i++){
                    v_tbl += "<td>" + v_cells[i] +"</td>";
                }

            v_tbl += "</tr>";
        }
        v_tbl += "</table>";

        // document.querySelector('body').innerHTML += v_tbl;
        document.querySelector('div').innerText = ""; //ê³µê°„ ì´ˆê¸°í™”
        document.querySelector('div').insertAdjacentHTML('beforeend',v_tbl);
    };

    const btn = document.querySelectorAll('button');
    btn[1].addEventListener('click',function(){
        let rst;
        let req = new XMLHttpRequest();
        req.open('get','sample/test.json');
        req.addEventListener('readystatechange',function(){
            if(req.readyState == 4 && req.status == 200){
                rst = req.responseText; //ë¬¸ìì—´ ì •ë³´
                // console.log("1>>>", rst);
                f_json(rst);
            }
        });
        req.send();
        // console.log("2>>>", rst); //ë¹„ë™ê¸° ì²˜ë¦¬ì‹œ undefinedë°œìƒ
    });
    
    let f_json = function(p_json){
        // console.log(p_json); //string
        // console.log(JSON.parse(p_json)); //string ==> object

        const objArr = JSON.parse(p_json);
        // console.log(objArr.length);

        //í…Œì´ë¸”ë¡œ ì •ë³´ ë°°ì¹˜í•˜ê¸°
        let v_tbl = "<table border=1>";
        
        //ë„˜ì–´ì˜¨ ê°ì²´ ë°°ì—´ ì •ë³´ ì¤‘ keyì •ë³´ë§Œ ì¶”ì¶œí•˜ì—¬ ì œëª©ìœ¼ë¡œ í™œìš©...
        //Object.keys() -> ê° ê°ì²´ì˜ í‚¤ ì •ë³´ë§Œ ë°°ì—´ë¡œ ë°˜í™˜í•˜ëŠ” ê²°ê³¼
        console.log(">>>", objArr[0] ); //4ê°œ ê°ì²´ì¤‘ í•˜ë‚˜ ì„ íƒ
        console.log(">>>", Object.keys(objArr[0]) ); //ê°ì²´ì˜ keyë§Œ ë½‘ì•„ëƒ„

        let objKey = Object.keys(objArr[0]); //3ê°œ keyì •ë³´

        // v_tbl += "<tr><th>" + objKey[0] + "</th><th>type</th><th>alias</th></tr>"; //ì œëª© í–‰ ì¶”ê°€
        v_tbl += `<tr><th>${objKey[0]}</th><th>${objKey[1]}</th><th>${objKey[2]}</th></tr>`; //ì œëª© í–‰ ì¶”ê°€

        
        for(let i=0; i<objArr.length; i++){
            v_tbl += `<tr>
                        <td>${objArr[i].name}</td>
                        <td>${objArr[i].type}</td>
                        <td>${objArr[i].alias}</td>
                    </tr>`;
        }
        v_tbl += "</table>";

        document.querySelector('div').innerText = ""; //ê³µê°„ ì´ˆê¸°í™”ê°€ ì„ í–‰ë˜ì–´ì•¼ í•¨
        //insert~HTML()ëŠ” ê¸°ì¡´ ìš”ì†Œ ë’¤ì— ë§ë¶™ì—¬ ì¶”ê°€í•˜ë¯€ë¡œ ê³„ì†ì ì¸ ìš”ì†Œ ì¶”ê°€ê°€ ì‹«ìœ¼ë©´
        document.querySelector('div').insertAdjacentHTML('beforeend',v_tbl);
    };

    btn[2].addEventListener('click',function(){
        const req = new XMLHttpRequest();
        req.open('get','sample/test.xml');
        req.onreadystatechange = function(){
            if(req.readyState == 4 && req.status == 200){
                // console.log(req.responseText); //ë¬¸ìì—´ë¡œ ì •ë³´ë¥¼ ì–»ìœ¼ë©´ ë‚´ë¶€ì •ë³´ì— ì ‘ê·¼í•˜ê¸° í˜ë“¦
                f_xml(req.responseXML); //XMLí˜•ì‹ëŒ€ë¡œ ì œê³µ
            }
        };
        req.send();
    });
    let f_xml = p_xml => {
        console.log( p_xml); //XMLë¬¸ì„œì—ë„ DOM APIí™œìš© ê°€ëŠ¥
        
                                                       //nodeType- ìš”ì†Œë…¸ë“œ>í…ìŠ¤íŠ¸ë…¸ë“œ
        // console.log( p_xml.querySelectorAll('friend')[0].children[0].firstChild.nodeValue); //í…ìŠ¤íŠ¸ë…¸ë“œê¹Œì§€ ì ‘ê·¼ í›„ ë…¸ë“œì†ì„± ì‚¬ìš©
        // console.log( p_xml.querySelectorAll('friend')[0].children[0].textContent); //ìš”ì†Œë…¸ë“œê¹Œì§€ ì ‘ê·¼ í›„ ë…¸ë“œì†ì„± ì‚¬ìš©
        // console.log( p_xml.querySelectorAll('friend')[0].children[0].innerText); //ë…¸ë“œëŒ€ìƒì— ì‚¬ìš©ë¶ˆê°€í•œ ì†ì„±ì´ë¯€ë¡œ undefinedì œê³µ
        
        let v_tbl = "<table border=1>";
        
        let friends = p_xml.querySelectorAll('friend'); //4ê°œì˜ friendë²”ìœ„ìš”ì†Œë¥¼ ì œê³µ
        for(let i=0; i<friends.length; i++){
            v_tbl += "<tr>";
            
            let child = friends[i].children; //ìì‹ìš”ì†Œ 3ê°œ ì–»ê¸°
            for(let i=0; i<child.length; i++){
                // v_tbl += `<td>${child[i].textContent}</td>`;
                v_tbl += `<td> ğŸ¨${child[i].firstChild.data}</td>`;
            }
            
            v_tbl += "</tr>";
        }
        v_tbl += "</table>";

        document.querySelector('div').innerHTML += v_tbl;

    }; 
        
        
        
        
        
        
</script>    
</body>
</html>